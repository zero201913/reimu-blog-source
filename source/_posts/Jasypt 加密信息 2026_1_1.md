---
cover: https://image.acg.lol/file/2025/11/09/reimu-11.jpg
title: Spring Boot集成Jasypt加密敏感配置最佳实践
date: 2026-1-1 09:30:00
categories: Spring Boot
excerpt: 本文详细介绍了如何在Spring Boot中集成Jasypt加密配置文件中的敏感信息（如数据库密码、API密钥等），包括基础集成步骤、自定义解密规则、生产环境最佳实践和密钥安全管理等核心内容，帮助开发者实现配置信息的安全加密。
---

# Spring Boot 集成 Jasypt 加密敏感配置最佳实践
Jasypt（Java Simplified Encryption）可安全加密 Spring Boot 配置文件中的敏感信息（如数据库密码、API 密钥、Redis 密码等），避免明文泄露。本文梳理规范的集成方案，涵盖环境隔离、密钥安全、算法选择等核心最佳实践。
## 一、核心原则
1. **密钥不硬编码**：禁止将加密密钥（secret key）写入代码或配置文件，优先通过环境变量、命令行参数或密钥管理服务（KMS）注入。
2. **环境隔离**：开发、测试、生产环境使用独立密钥，生产环境密钥需严格保密（仅运维/核心人员知晓）。
3. **按需加密**：仅加密敏感字段（密码、密钥、令牌等），非敏感配置（端口、日志级别、超时时间等）无需加密。
4. **算法安全**：使用高强度加密算法（如 PBKDF2WithHmacSHA512 + AES-256），避免 MD5、DES 等弱算法。

## 二、集成步骤（基础版：默认解密方式）
基于 `jasypt-spring-boot-starter` 实现配置文件敏感信息自动加密/解密，步骤如下：

### 步骤 1：引入 Maven 依赖
```xml
<dependency>
    <groupId>com.github.ulisesbocchio</groupId>
    <artifactId>jasypt-spring-boot-starter</artifactId>
    <version>3.0.3</version> <!-- 推荐使用最新稳定版 -->
</dependency>

```

### 步骤 2：配置 Jasypt 解密规则
在 `application.yml`（或 `application.properties`）中配置加密密钥、算法等核心参数：

```yaml
jasypt:
  encryptor:
    password: mySecretKey  # 加密/解密密钥（生产环境禁止写在此处）
    algorithm: PBEWithMD5AndDES  # 加密算法（基础版，生产建议替换为高强度算法）
    iv-generator-classname: org.jasypt.iv.NoIvGenerator  # 禁用IV生成（适配基础算法）
```

### 步骤 3：生成加密内容
编写工具类生成敏感信息的密文（如数据库密码 `123456`）：

```java
import org.jasypt.util.text.BasicTextEncryptor;

public class JasyptEncryptUtil {
    public static void main(String[] args) {
        // 初始化加密器
        BasicTextEncryptor encryptor = new BasicTextEncryptor();
        encryptor.setPassword("mySecretKey"); // 与配置文件中的密钥一致
        
        // 加密敏感信息
        String plainText = "123456"; // 原始明文（数据库密码）
        String cipherText = encryptor.encrypt(plainText);
        System.out.println("密文：" + cipherText); // 输出示例：kud5ZnaMJYve284geT0ITw==
    }
}
```

### 步骤 4：替换配置文件中的明文为密文
将生成的密文包裹在 `ENC()` 中，替换配置文件中的敏感信息明文：

```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/test_db
    username: root
    password: ENC(kud5ZnaMJYve284geT0ITw==)  # 密文需包裹在ENC()中
```

### 步骤 5：启用自动解密
在 Spring Boot 启动类上添加 `@EnableEncryptableProperties` 注解，开启配置自动解密：

```java
import com.ulisesbocchio.jasyptspringboot.annotation.EnableEncryptableProperties;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@EnableEncryptableProperties // 启用加密配置自动解密
@SpringBootApplication
public class SpringBootJasyptApplication {
    public static void main(String[] args) {
        SpringApplication.run(SpringBootJasyptApplication.class, args);
    }
}
```

## 三、进阶配置（自定义解密规则）
若需自定义密文前缀/后缀、加密算法或解密逻辑，可实现 Jasypt 核心接口。

### 场景 1：自定义密文前后缀（替换默认 ENC()）
默认 Jasypt 通过 `ENC()` 识别密文，可自定义为 `ikms()` 等格式：

```java
import com.ulisesbocchio.jasyptspringboot.EncryptablePropertyDetector;
import org.springframework.stereotype.Component;

/**
 * 自定义密文检测器：识别以 ikms() 包裹的内容为密文
 */
@Component
public class MyEncryptablePropertyDetector implements EncryptablePropertyDetector {

    @Override
    public boolean isEncrypted(String value) {
        // 判断值是否为密文（非空 + 以ikms(开头 + 以)结尾）
        return value != null && value.startsWith("ikms(") && value.endsWith(")");
    }

    @Override
    public String unwrapEncryptedValue(String value) {
        // 剥离前后缀，返回纯密文（此处可根据需求调整）
        return value.substring(5, value.length() - 1);
    }
}
```

### 场景 2：自定义解密逻辑（如凯撒加密）
实现 `StringEncryptor` 接口，自定义解密算法：

```java
import org.jasypt.encryption.StringEncryptor;
import org.springframework.stereotype.Component;

@Component
public class CustomStringEncryptor implements StringEncryptor {

    @Override
    public String encrypt(String plainText) {
        // 自定义加密逻辑（示例：凯撒加密）
        return KaiserUtil.encryptKaiser(plainText, 123456);
    }

    @Override
    public String decrypt(String cipherText) {
        // 自定义解密逻辑（示例：凯撒解密）
        return KaiserUtil.decryptKaiser(cipherText, 123456);
    }
}

// 凯撒加密工具类（示例）
class KaiserUtil {
    // 凯撒加密
    public static String encryptKaiser(String text, int key) {
        char[] chars = text.toCharArray();
        StringBuilder sb = new StringBuilder();
        for (char c : chars) {
            sb.append((char) (c + key));
        }
        return sb.toString();
    }

    // 凯撒解密
    public static String decryptKaiser(String text, int key) {
        char[] chars = text.toCharArray();
        StringBuilder sb = new StringBuilder();
        for (char c : chars) {
            sb.append((char) (c - key));
        }
        return sb.toString();
    }
}
```

## 四、生产环境最佳实践
### 1. 密钥安全注入（禁止硬编码）
生产环境需通过启动参数、环境变量或 KMS 注入密钥，示例：

#### 方式 1：命令行启动参数
```bash
java -jar app.jar --jasypt.encryptor.password=prodSecretKey123!
```

#### 方式 2：环境变量（Linux/Mac）
```bash
export JASYPT_ENCRYPTOR_PASSWORD=prodSecretKey123!
java -jar app.jar
```

配置文件中引用环境变量：

```yaml
jasypt:
  encryptor:
    password: ${JASYPT_ENCRYPTOR_PASSWORD}
```

#### 方式 3：容器化部署（Docker/K8s）
Dockerfile 中设置环境变量：

```dockerfile
ENV JASYPT_ENCRYPTOR_PASSWORD=prodSecretKey123!
```

K8s ConfigMap/Secret 注入：

```yaml
apiVersion: v1
kind: Secret
metadata:
  name: jasypt-secret
type: Opaque
data:
  jasypt-password: cHJvZFNlY3JldEtleTEyMyE= # 加密后的密钥（base64编码）
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: app-deploy
spec:
  template:
    spec:
      containers:
      - name: app
        image: app:latest
        env:
        - name: JASYPT_ENCRYPTOR_PASSWORD
          valueFrom:
            secretKeyRef:
              name: jasypt-secret
              key: jasypt-password
```

### 2. 升级加密算法（高强度）
替换基础算法为 AES-256 等高强度算法：

```yaml
jasypt:
  encryptor:
    password: ${JASYPT_ENCRYPTOR_PASSWORD}
    algorithm: PBKDF2WithHmacSHA512AndAES_256  # 高强度算法
    key-obtention-iterations: 100000  # 迭代次数（越高越安全）
    pool-size: 1  # 加密池大小
    provider-name: SunJCE
    salt-generator-classname: org.jasypt.salt.RandomSaltGenerator  # 随机盐值
    iv-generator-classname: org.jasypt.iv.RandomIvGenerator  # 随机IV
    string-output-type: base64  # 输出格式
```

### 3. 验证解密有效性
启动应用后，通过代码验证敏感配置是否解密成功：

```java
import org.springframework.beans.factory.annotation.Value;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class ConfigTestController {

    @Value("${spring.datasource.password}")
    private String dbPassword;

    @GetMapping("/test/db/password")
    public String getDbPassword() {
        return dbPassword; // 应返回解密后的明文（123456）
    }
}
```

### 4. 多环境隔离
为开发、测试、生产环境配置不同密钥，通过 `spring.profiles.active` 区分：

```yaml
# application-dev.yml（开发环境）
jasypt:
  encryptor:
    password: devSecretKey

# application-test.yml（测试环境）
jasypt:
  encryptor:
    password: testSecretKey

# application-prod.yml（生产环境）
jasypt:
  encryptor:
    password: ${JASYPT_ENCRYPTOR_PASSWORD}
```

## 参考链接
+ 项目应用案例：[https://github.com/zero201913/jasypt-demo](https://github.com/zero201913/jasypt-demo)
+ jasypt-spring-boot 开源地址：[https://github.com/ulisesbocchio/jasypt-spring-boot](https://github.com/ulisesbocchio/jasypt-spring-boot)
+ 进阶配置示例：[https://pxzxj.github.io/articles/jasypt.html](https://pxzxj.github.io/articles/jasypt.html)


